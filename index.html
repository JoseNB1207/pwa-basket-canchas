<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Canchas de Baloncesto Cercanas</title>

<!-- Manifest para PWA -->
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2c3e50" />

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
  }
  header {
    background-color: #2c3e50;
    color: white;
    padding: 1rem;
    text-align: center;
  }
  #map {
    height: 60vh;
    width: 100%;
  }
  #lista-canchas-container {
    padding: 1rem;
  }
  #lista-canchas {
    max-height: 35vh;
    overflow-y: auto;
  }
  .cancha {
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 1rem;
    padding: 1rem;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    cursor: default;
  }
  .calificacion {
    color: #f39c12;
    font-weight: bold;
  }
  .ambiente {
    font-style: italic;
    color: #27ae60;
  }
  .defecto {
    color: #e74c3c;
  }
  #volver-lista-btn {
    display: none;
    margin-bottom: 1rem;
    padding: 0.5rem 1rem;
    background-color: #2980b9;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  #volver-lista-btn:hover {
    background-color: #3498db;
  }
</style>
</head>
<body>

<header>
  <h1>Canchas de Baloncesto Cercanas</h1>
  <p>Descubre las mejores canchas a tu alrededor</p>
</header>

<div id="map"></div>

<div id="lista-canchas-container">
  <button id="volver-lista-btn">← Volver a la lista completa</button>
  <div id="lista-canchas"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // Icono cancha
  const canchaIcon = L.icon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/256/10443/10443831.png',
    iconSize: [32, 32],
    iconAnchor: [16, 32],
    popupAnchor: [0, -32]
  });

  // Datos canchas en NYC, Bogotá y Madrid (5 canchas por ciudad)
  const canchas = [
    // NUEVA YORK
    {
      id: 1,
      nombre: "Cancha Central NYC",
      lat: 40.712776,
      lng: -74.005974,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.7,
      ambiente: "Muy buen ambiente, jugadores frecuentes y torneos los fines de semana"
    },
    {
      id: 2,
      nombre: "Cancha La Plaza NYC",
      lat: 40.715,
      lng: -74.002,
      calidad: "Media",
      malla: false,
      defectos: ["Huecos en el piso", "Sin pintura"],
      calificacion: 3.8,
      ambiente: "Ambiente tranquilo, ideal para práctica personal"
    },
    {
      id: 3,
      nombre: "Cancha El Bosque NYC",
      lat: 40.709,
      lng: -74.01,
      calidad: "Baja",
      malla: true,
      defectos: ["Piso resbaladizo"],
      calificacion: 2.9,
      ambiente: "Poco ambiente, jugadores ocasionales"
    },
    {
      id: 4,
      nombre: "Cancha Olímpica NYC",
      lat: 40.716,
      lng: -74.008,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.9,
      ambiente: "Ambiente excelente, equipos locales juegan a diario"
    },
    {
      id: 5,
      nombre: "Cancha Riverside NYC",
      lat: 40.720,
      lng: -74.015,
      calidad: "Media",
      malla: true,
      defectos: ["Pintura desgastada"],
      calificacion: 4.1,
      ambiente: "Ambiente familiar y relajado"
    },

    // BOGOTÁ
    {
      id: 6,
      nombre: "Cancha Parque Simón Bolívar",
      lat: 4.667785,
      lng: -74.095809,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.8,
      ambiente: "Ambiente deportivo activo con juegos frecuentes y torneos locales"
    },
    {
      id: 7,
      nombre: "Cancha Ciudad Salitre",
      lat: 4.663451,
      lng: -74.104675,
      calidad: "Media",
      malla: false,
      defectos: ["Sin malla", "Pintura desgastada"],
      calificacion: 3.7,
      ambiente: "Ambiente familiar y tranquilo"
    },
    {
      id: 8,
      nombre: "Cancha El Campín",
      lat: 4.669411,
      lng: -74.095305,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.6,
      ambiente: "Ambiente competitivo con ligas locales"
    },
    {
      id: 9,
      nombre: "Cancha Parque El Virrey",
      lat: 4.672228,
      lng: -74.055464,
      calidad: "Media",
      malla: true,
      defectos: ["Huecos en algunas zonas"],
      calificacion: 3.9,
      ambiente: "Ambiente relajado, jugadores recreativos"
    },
    {
      id: 10,
      nombre: "Cancha Teusaquillo",
      lat: 4.655376,
      lng: -74.073497,
      calidad: "Baja",
      malla: false,
      defectos: ["No tiene malla", "Superficie irregular"],
      calificacion: 2.8,
      ambiente: "Poco ambiente, cancha usada ocasionalmente"
    },

    // MADRID
    {
      id: 11,
      nombre: "Cancha Parque La Vaguada",
      lat: 40.471473,
      lng: -3.694932,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.5,
      ambiente: "Ambiente excelente, jugadores locales y torneos informales"
    },
    {
      id: 12,
      nombre: "Cancha El Retiro",
      lat: 40.413782,
      lng: -3.684226,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.8,
      ambiente: "Muy buen ambiente, gran afluencia de jugadores jóvenes"
    },
    {
      id: 13,
      nombre: "Cancha Palacio de los Deportes",
      lat: 40.421977,
      lng: -3.679606,
      calidad: "Alta",
      malla: true,
      defectos: [],
      calificacion: 4.9,
      ambiente: "Cancha de alto rendimiento, muchos jugadores profesionales"
    },
    {
      id: 14,
      nombre: "Cancha Madrid Río",
      lat: 40.407303,
      lng: -3.713732,
      calidad: "Media",
      malla: true,
      defectos: ["Superficie irregular"],
      calificacion: 4.2,
      ambiente: "Ambiente tranquilo y familiar"
    },
    {
      id: 15,
      nombre: "Cancha Ciudad Lineal",
      lat: 40.433623,
      lng: -3.640057,
      calidad: "Media",
      malla: false,
      defectos: ["Piso con grietas"],
      calificacion: 3.5,
      ambiente: "Ambiente relajado, pocos jugadores"
    }
  ];

  let userMarker = null;
  let markersLayer = null;

  // Mostrar lista de todas las canchas
  function mostrarLista(canchasLista) {
    const listaDiv = document.getElementById('lista-canchas');
    listaDiv.innerHTML = '';

    canchasLista.forEach(cancha => {
      const canchaDiv = document.createElement('div');
      canchaDiv.className = 'cancha';
      canchaDiv.innerHTML = `
        <h3>${cancha.nombre}</h3>
        <p><strong>Calidad:</strong> ${cancha.calidad}</p>
        <p><strong>Malla:</strong> ${cancha.malla ? 'Sí' : '<span class="defecto">No</span>'}</p>
        <p><strong>Defectos:</strong> ${cancha.defectos.length > 0 ? cancha.defectos.map(d => `<span class="defecto">${d}</span>`).join(', ') : 'Ninguno'}</p>
        <p><strong>Calificación:</strong> <span class="calificacion">${cancha.calificacion} ⭐</span></p>
        <p><strong>Ambiente:</strong> <span class="ambiente">${cancha.ambiente}</span></p>
      `;
      listaDiv.appendChild(canchaDiv);
    });
  }

  // Agrega marcadores para todas las canchas
  function agregarMarcadores(canchasLista) {
    if (markersLayer) {
      markersLayer.clearLayers();
    } else {
      markersLayer = L.layerGroup().addTo(map);
    }

    canchasLista.forEach(cancha => {
      const marker = L.marker([cancha.lat, cancha.lng], {icon: canchaIcon});
      marker.bindPopup(`
        <b>${cancha.nombre}</b><br/>
        Calidad: ${cancha.calidad}<br/>
        Malla: ${cancha.malla ? 'Sí' : 'No'}<br/>
        Defectos: ${cancha.defectos.length > 0 ? cancha.defectos.join(', ') : 'Ninguno'}<br/>
        Calificación: ${cancha.calificacion} ⭐<br/>
        Ambiente: ${cancha.ambiente}
      `);
      marker.addTo(markersLayer);

      marker.on('click', () => {
        mostrarLista([cancha]);
        document.getElementById('volver-lista-btn').style.display = 'inline-block';
      });
    });
  }

  // Botón para volver a la lista completa
  document.getElementById('volver-lista-btn').addEventListener('click', () => {
    mostrarLista(canchas);
    agregarMarcadores(canchas);
    document.getElementById('volver-lista-btn').style.display = 'none';
  });

  // Coloca o mueve marcador del usuario
  function colocarMarcadorUsuario(lat, lng) {
    if (userMarker) {
      userMarker.setLatLng([lat, lng]);
    } else {
      userMarker = L.marker([lat, lng], {title: 'Tu ubicación'}).addTo(map).bindPopup("¡Tú estás aquí!").openPopup();
    }
  }

  // Inicialización del mapa
  const map = L.map('map').setView([4.667785, -74.095809], 5); // Zoom bajo para ver ambas ciudades

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Inicializa ubicación y muestra todas las canchas
  function init() {
    mostrarLista(canchas);
    agregarMarcadores(canchas);

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const userLatLng = {
            lat: pos.coords.latitude,
            lng: pos.coords.longitude
          };
          colocarMarcadorUsuario(userLatLng.lat, userLatLng.lng);

          // Centrar mapa cerca del usuario pero con zoom para ver más canchas
          map.setView([userLatLng.lat, userLatLng.lng], 12);
        },
        () => {
          console.warn("No se pudo obtener tu ubicación. Mostrando mapa con todas las canchas.");
          // Mantiene vista general
        }
      );
    }
  }

  init();
</script>

<!-- Registro Service Worker para PWA -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./service-worker.js')
      .then(reg => {
        console.log('Service Worker registrado con éxito:', reg.scope);
      }).catch(err => {
        console.error('Error registrando Service Worker:', err);
      });
    });
  }
</script>

</body>
</html>
